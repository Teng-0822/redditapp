<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>BEAST MODE</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<style>
:root { --bg: #0d0d0d; --card: #1a1a1a; --accent: #ff0066; --accent2: #00ff99; }
* { margin:0; padding:0; box-sizing:border-box; }
body { background: var(--bg); color: white; font-family: 'Segoe UI', Arial, sans-serif; min-height: 100vh; padding: 15px 15px 110px 15px; background: gray; }
h1 { text-align:center; font-size: 2.8rem; background: linear-gradient(90deg, #ff0066, #00ff99); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 15px 0 20px; }
#ipInput { display: block; width: 110px; margin: 0 auto 15px; padding: 8px; font-size: 1rem; text-align: center; background: #222; color: #0f9; border: 1px solid #444; border-radius: 10px; }
/* DROPDOWNS */
.dropdown { background: var(--card); border-radius: 18px; margin: 16px auto; max-width: 420px; box-shadow: 0 8px 25px rgba(0,0,0,0.8); border: 1px solid #333; overflow: hidden; }
.dropdown-header { display: flex; height: 70px; align-items: center; justify-content: space-between; padding: 18px 24px; cursor: pointer; background: rgba(255,255,255,0.03); }
.center-btn { flex: 1; display: flex; justify-content: left; }
.dropdown-header button { padding: 11px 40px; font-size: 1.25rem; font-weight: bold; border: none; border-radius: 16px; min-width: 180px; height: 52px; color: black; }
.ip-header { font-size: 1.4rem; font-weight: bold; color: White; flex: 1; text-align: left; padding-left: 8px; }
.arrow { font-size: 28px; transition: transform 0.3s ease; color: #aaa; min-width: 50px; text-align: right; }
.arrow.open { transform: rotate(180deg); }
.dropdown-content { padding: 0 20px; max-height: 0; overflow: hidden; transition: max-height 0.4s ease, padding 0.4s ease; background: gray; }
.dropdown-content.open { max-height: 600px; padding: 16px 20px; }
.content-row { display: flex; justify-content: space-between; align-items: center; margin: 12px 0; font-size: 0.95rem; color: #ccc; }
.content-row button { background: #333; color: #ff0066; border: 2px solid orange; padding: 8px 16px; border-radius: 12px; font-size: 0.9rem; }
.content-row .toggle { background: #222; color: #999; border: 1px solid #444; }
ul { list-style: none; max-height: 260px; overflow-y: auto; padding: 8px; background: #111; border-radius: 10px; border: 1px solid #333; margin-top: 12px; -webkit-overflow-scrolling: touch; }
li { padding: 12px; background: #222; margin: 8px 0; border-radius: 10px; display: flex; align-items: center; gap: 12px; position: relative; overflow: hidden; }
li.checked { opacity: 0.4; text-decoration: line-through; }
li .text { flex: 1; min-width: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-size: 0.95rem; color: #ddd; padding-right: 10px; }
li .text::after { content: ''; position: absolute; right: 60px; top: 0; bottom: 0; width: 30px; background: linear-gradient(to right, transparent, #222); pointer-events: none; }
.delete { background: none; border: none; color: var(--accent); font-size: 28px; font-weight: bold; min-width: 44px; text-align: center; cursor: pointer; }
#rotateBtn { padding: 8px 12px; border-radius: 10px; background: orange; color: black; border: 2px solid black; }
#refreshBtn { padding: 6px 12px; background: orange; color: black; border: 1px solid whitesmoke; border-radius: 10px; font-size: 11px; }
.fab-container { position: fixed; bottom: 18px; left: 50%; transform: translateX(-50%); display: flex; gap: 18px; z-index: 9999; background: gray; padding: 12px 24px; border-radius: 50px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 8px 30px rgba(0,0,0,0.6); }
.fab { width: 64px; height: 64px; border-radius: 50%; border: none; color: black; font-size: 26px; font-weight: bold; box-shadow: 0 6px 20px rgba(0,0,0,0.8); }
.fab:hover { transform: scale(1.1) rotate(5deg); box-shadow: 0 0 40px rgba(255,0,102,0.8), 0 0 60px rgba(0,255,153,0.6); }
.fab:active { transform: scale(0.9); }
#toast { position: fixed; bottom: 110px; left: 50%; transform: translateX(-50%); background: orange; color: black; padding: 12px 28px; border-radius: 30px; font-weight: bold; font-size: 1rem; z-index: 10000; opacity: 0; transition: all 0.4s; backdrop-filter: blur(10px); border: 5px solid black; pointer-events: none; }
#toast.show { opacity: 1; bottom: 130px; }
#comboFab { position: fixed; bottom: 100px; right: 155px; width: 68px; height: 68px; background: orange; color: black; border: 5px solid black; border-radius: 50%; font-size: 18px; font-weight: 900; letter-spacing: 1px; z-index: 99999; cursor: pointer; backdrop-filter: blur(1px); transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; }
#comboFab:hover { transform: scale(1.1) rotate(5deg); box-shadow: 0 0 40px rgba(255,0,102,0.8), 0 0 60px rgba(0,255,153,0.6); }
#comboFab:active { transform: scale(0.95); }
#randomSubBtn { position: fixed; bottom: 100px; right: 75px; width: 68px; height: 68px; background: orange; color: black; border: 5px solid black; border-radius: 50%; font-size: 28px; font-weight: 900; z-index: 99999; cursor: pointer; display: flex; align-items: center; justify-content: center; }
#randomSubBtn:hover { transform: scale(1.1) rotate(5deg); box-shadow: 0 0 40px rgba(255,0,102,0.8), 0 0 60px rgba(0,255,153,0.6); }
</style>
</head>
<body>
<div style="display:flex; align-items:justify-content; justify-content:jus; gap:14px; margin:20px auto 15px; max-width:420px; padding:0 10px;">
  <input type="text" id="ipInput" placeholder="IP last" value="1" maxlength="16" style="width:96px; height:48px; padding:8px; font-size:1.1rem; text-align:center; background:orange; color:black; border:2px solid black; border-radius:14px; font-weight:bold; outline:none; margin-left: 0px;">
  <button id="ipToggle" style="height:48px; padding:8px; background: orange; color:black; border:2px solid black; border-radius:14px; font-weight:bold; font-size:1.05rem; min-width:148px; cursor:pointer; transition:all 0.2s;"> 192.168.1.x </button>
</div>

<!-- PROFILE DROPDOWN -->
<div class="dropdown">
  <div class="dropdown-header">
    <div class="center-btn"><button style="background:orange; border:5px solid black; cursor:default;">PROFILE</button></div>
    <span class="arrow" id="profileArrow" onclick="toggleDropdown('profile')"><img src="penis.png" alt="My Button" width="40px" height="40px"></span>
  </div>
  <div class="dropdown-content" id="profileContent">
    <div style="padding:16px 20px; max-width:100%; box-sizing:border-box;">
      <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px 12px; margin-bottom:12px;">
        <input type="text" id="profileName" placeholder="Name" readonly style="padding:13px 10px; border-radius:12px; background:black; border:2px solid orange; color:white; text-align:center; font-weight:bold; font-size:0.95rem; width:100%;">
        <input type="text" id="profileUser" placeholder="Username" style="padding:13px 10px; border-radius:12px; background:black; border:2px solid orange; color:white; text-align:center; font-weight:bold; font-size:0.95rem; width:100%;">
        <input type="text" id="profilePass" placeholder="Password" style="padding:13px 10px; border-radius:12px; background:black; border:2px solid orange; color:white; text-align:center; font-weight:bold; font-size:0.95rem; width:100%;">
        <input type="text" id="profileID" placeholder="ID" readonly style="padding:13px 10px; border-radius:12px; background:black; border:2px solid orange; color:white; text-align:center; font-weight:bold; font-size:0.95rem; width:100%;">
      </div>
      <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:12px;">
        <button onclick="copyText('profileName'); triggerLua()" style="background:orange; color:black; padding:12px 8px; border-radius:12px; font-weight:bold; font-size:0.9rem;">Copy Email</button>
        <button onclick="copyText('profileUser')" style="background:orange; color:black; padding:12px 8px; border-radius:12px; font-weight:bold; font-size:0.9rem;">Copy User</button>
        <button onclick="copyText('profilePass'); triggerLua()" style="background:orange; color:black; padding:12px 8px; border-radius:12px; font-weight:bold; font-size:0.9rem;">Copy Pass</button>
        <button onclick="copyText('profileID')" style="background:orange; color:black; padding:12px 8px; border-radius:12px; font-weight:bold; font-size:0.9rem;">Copy ID</button>
      </div>
      <div style="display:flex; flex-direction:column; gap:11px; align-items:center;">
        <div style="display:grid; grid-template-columns:1fr 1fr 1fr 1fr; gap:9px; width:100%; max-width:380px;">
          <button onclick="prevProfile()" style="background:black; color:orange; padding:12px 8px; border-radius:12px; font-weight:bold; font-size:0.9rem;">Prev</button>
          <button onclick="generatePassword(); triggerLua()" style="background:black; color:orange; padding:12px 8px; border-radius:12px; font-weight:bold; font-size:0.9rem;">Generate</button>
          <button onclick="pasteUsername()" style="background:black; color:orange; padding:12px 8px; border-radius:12px; font-weight:bold; font-size:0.9rem;">Username</button>
          <button onclick="nextProfile()" style="background:black; color:orange; padding:12px 8px; border-radius:12px; font-weight:bold; font-size:0.9rem;">Next</button>
        </div>
        <button onclick="saveProfile()" style="background:black; color:orange; padding:12px 8px; border-radius:12px; font-weight:bold; font-size:0.9rem; min-width:180px; width:auto; max-width:340px;"> Save </button>
      </div>
    </div>
  </div>
</div>

<!-- SUBREDDIT DROPDOWN -->
<div class="dropdown">
  <div class="dropdown-header">
    <div class="center-btn"><button id="subrBtn" onclick="event.stopPropagation()" style="background:orange; border:5px solid black; cursor:default;">SubReddit</button></div>
    <span class="arrow" id="subArrow" onclick="toggleDropdown('sub')"><img src="penis.png" alt="My Button" width="40px" height="40px"></span>
  </div>
  <div class="dropdown-content" id="subContent">
    <div class="content-row">
      <span>Done <span id="subDone">0</span> / <span id="subCount">0</span></span>
      <div style="display:flex; gap:8px;">
        <button id="subrReset" style="background:gray;color:#000;padding:8px 16px;border-radius:12px;font-weight:bold;">Reset</button>
        <button id="addSubBtn" style="background:gray;color:#000;padding:8px 16px;border-radius:12px;font-weight:bold;">+ Add</button>
      </div>
    </div>
    <div class="content-row" style="justify-content: flex-end; gap: 10px;">
      <button id="subRefresh" style="background:gray;color:#000;padding:8px 16px;border-radius:12px;font-weight:bold;">Refresh</button>
      <button class="toggle" id="toggleSub">List</button>
    </div>
    <ul id="subList" style="display:none;"></ul>
  </div>
</div>

<!-- CAPTION DROPDOWN -->
<div class="dropdown">
  <div class="dropdown-header">
    <div class="center-btn"><button id="captionBtn" onclick="event.stopPropagation()" style="background:orange; border:5px solid black; cursor:default;">CAPTION</button></div>
    <span class="arrow" id="capArrow" onclick="toggleDropdown('cap')"><img src="penis.png" alt="My Button" width="40px" height="40px"></span>
  </div>
  <div class="dropdown-content" id="capContent">
    <div class="content-row">
      <span>Used <span id="capUsed">0</span> / <span id="capCount">0</span></span>
      <div style="display:flex; gap:8px;">
        <button id="captionReset" style="background:gray;color:#000;padding:8px 16px;border-radius:12px;font-weight:bold;">Reset</button>
        <button id="addCapBtn" style="background:gray;color:#000;padding:8px 16px;border-radius:12px;font-weight:bold;">+ Add</button>
      </div>
    </div>
    <div class="content-row" style="justify-content: flex-end; gap: 10px;">
      <button onclick="updateCaptionsNow()" style="background:gray;color:#000;padding:8px 16px;border-radius:12px;font-weight:bold;"> Refresh </button>
      <button class="toggle" id="toggleCap" style="padding:8px 16px; border-radius:12px;"> List </button>
    </div>
    <ul id="captionList" style="display:none;"></ul>
  </div>
</div>

<!-- IP & ROTATION DROPDOWN -->
<div class="dropdown">
  <div class="dropdown-header">
    <div class="ip-header"><span id="ipHeader">Loading IP...</span></div>
    <span class="arrow" id="ipArrow" onclick="toggleDropdown('ip')"><img src="penis.png" alt="My Button" width="40px" height="40px"></span>
  </div>
  <div class="dropdown-content" id="ipContent">
    <div style="padding:10px 0;">
      <div style="display:flex; gap:5px; margin:10px 0;">
        <button id="rotateBtn" onclick="rotateIP()">Go</button>
        <input id="rotateLink" placeholder="http://87.120..." style="flex:1;padding:8px;border-radius:10px;background:orange;border:1px solid black;color:black;" />
      </div>
      <div style="background: black;border-radius:12px;padding:14px;text-align:center;font-family:monospace;border:2px solid orange;">
        <div style="color:White;font-size:14px; font-weight: bold;">Old to <span id="oldIP">â€”</span> <span id="ip" style="color:White;font-size:14px; font-weight: bold;">Loading...</span> </div>
        <button id="refreshBtn" onclick="refreshAndOpen()">Refresh + Scam</button>
      </div>
    </div>
  </div>
</div>

<!-- FLOATING BUTTONS -->
<div class="fab-container">
  <button id="comboFab">SAP</button>
  <button id="randomSubBtn">R</button>
</div>


<div class="fab-container">
  <button id="fabD" class="fab" style="background:orange; border:5px solid black;">D</button>
  <button id="fabN" class="fab" style="background:orange; border:5px solid black;">N</button>
  <button id="fabOF" class="fab" style="background:orange; border:5px solid black;">OF</button>
  <button id="fabLink" class="fab" style="background:orange; border:5px solid black;">Link</button>
  <button id="fabCreate" class="fab" style="background:orange; border:5px solid black;">+</button>
</div>
<div id="toast"></div>

<script>
const SHEET_URL = "https://script.google.com/macros/s/AKfycbyXhbEHzbbk1vmmrAFBEE1vBSNb-FGdJgZ1nYLnRTxJ2yW8YxSfb2BeRJ0N6gZ1Rayi/exec";
const PROFILE_URL = SHEET_URL;

let subs = [];
let captions = [];
let randomSubList = [];
let subChecked = JSON.parse(localStorage.getItem('subCh3')||'null') || {};
let subIndex = parseInt(localStorage.getItem('subIdx3')||'0');
let capUsed = JSON.parse(localStorage.getItem('capUs3')||'null') || {};
let dmUsed = JSON.parse(localStorage.getItem('dmUsed')||'null') || {};
let nameUsed = JSON.parse(localStorage.getItem('nameUsed')||'null') || {};
let ofUsed = JSON.parse(localStorage.getItem('ofUsed')||'null') || {};

const dmTexts = [ "Iâ€™m new here, come take a peek at my page below and enjoy a little surprise I left for you", "Still figuring things out here, check out my page and grab your free surprise", "Just getting started here, have a look at my page and claim your cute freebie", "Iâ€™m the new girl here, check my page and treat yourself to a sweet surprise", "Super new here, come visit my page and enjoy a little gift from me", "Just joined, have a look at my page and donâ€™t miss the free surprise waiting for you", "Newbie alert, come check my page and grab the adorable surprise I made for you", "Iâ€™m fresh here, take a moment to visit my page and get your special little treat", "Still new around here, check out my page and enjoy your free surprise", "Just starting out here, come see my page and pick up the cute surprise I prepared for you" ];
const names = [ "Sophyy ðŸŒ¸", "Sophiaa ðŸŒ·", "Sophi ðŸ’‹", "Sophiya ðŸŒº", "Sofayuh ðŸ˜", "Soffie ðŸŒ¼", "Sofey ðŸ’–", "Soffyy ðŸ˜", "Sofy ðŸ’˜", "Sofiy ðŸ¦‹", "Sofiahh ðŸ¬", "Sofiaaaa ðŸ’•", "Sophie ðŸ˜", "Sophia ðŸ˜Š", "Sofie ðŸ™ˆ", "Sofiaa ðŸ˜", "Sofia ðŸ‘", "Sofiyah âœ¨", "Sofiya ðŸ’ž", "Sofii ðŸ’•", "Sofiee ðŸ˜˜", "Sofiah ðŸ’—", "Sophiyaaa ðŸ˜", "Sophiie ðŸ™ˆ", "Sofiyaaa âœ¨" ];
const ofLines = [ "OF (nudes&dms)ðŸ˜œ", "OF (nudez&seks)ðŸ˜œ", "OF (nudes&dms)ðŸ™ˆ" ];
const linkUrl = "https://tapformysocials.me/girlygirl";

async function loadFromSheet() {
  try {
    const resp = await fetch(SHEET_URL + "?action=readAll&t=" + Date.now());
    const data = await resp.json();
    const rows = data.values || [];
    subs = rows.map(r => r[4]).filter(Boolean); // Column E
    captions = rows.map(r => r[5]).filter(Boolean); // Column F
    randomSubList = rows.map(r => r[6]).filter(Boolean); // Column G
    if (subs.length === 0) subs = JSON.parse(localStorage.getItem('subs3') || '[]');
    if (captions.length === 0) captions = JSON.parse(localStorage.getItem('caps3') || '[]');
    render('subList', subs, subChecked);
    render('captionList', captions, capUsed);
    updateStats();
    showToast(`Sheet loaded â€“ Subs: ${subs.length} | Caps: ${captions.length}`);
  } catch (e) {
    subs = JSON.parse(localStorage.getItem('subs3') || '[]');
    captions = JSON.parse(localStorage.getItem('caps3') || '[]');
    render('subList', subs, subChecked);
    render('captionList', captions, capUsed);
    updateStats();
    showToast("Sheet offline â€“ using local data");
  }
}

const save = () => {
  localStorage.setItem('subs3', JSON.stringify(subs));
  localStorage.setItem('subCh3', JSON.stringify(subChecked));
  localStorage.setItem('subIdx3', subIndex);
  localStorage.setItem('caps3', JSON.stringify(captions));
  localStorage.setItem('capUs3', JSON.stringify(capUsed));
  localStorage.setItem('dmUsed', JSON.stringify(dmUsed));
  localStorage.setItem('nameUsed', JSON.stringify(nameUsed));
  localStorage.setItem('ofUsed', JSON.stringify(ofUsed));
};

let baseIP = localStorage.getItem('selectedBaseIP') || '192.168.1';

function updateToggleButton() {
  const btn = document.getElementById('ipToggle');
  if (baseIP === '192.168.1') {
    btn.textContent = '192.168.1.x';
    btn.style.background = 'orange';
    btn.style.border = '2px solid black';
    btn.style.color = 'black';
  } else {
    btn.textContent = 'FULL IP';
    btn.style.background = 'black';
    btn.style.border = '2px solid orange';
    btn.style.color = 'white';
  }
}

document.getElementById('ipToggle').onclick = () => {
  baseIP = baseIP === '192.168.1' ? 'FULL' : '192.168.1';
  localStorage.setItem('selectedBaseIP', baseIP);
  updateToggleButton();
  showToast(baseIP === 'FULL' ? 'Full IP mode' : '192.168.1.x mode');
};

function triggerLua() {
  const input = document.getElementById("ipInput").value.trim();
  if (!input) return;

  let finalIP;

  if (baseIP === '192.168.1') {
    // only last digits typed (example: "55")
    if (isNaN(input)) return;
    finalIP = `192.168.1.${input}`;
  } else {
    // FULL MODE: user enters full IP (example: "10.161.37.55")
    finalIP = input;
  }

  const url = `http://${finalIP}:8080/control/start_playing?path=/test.lua&t=${Date.now()}`;
  new Image().src = url;

  showToast(`Triggered: ${finalIP}`);
}

// initialize UI state on page load
updateToggleButton();


function toggleDropdown(type) {
  const map = { sub: 'subContent', cap: 'capContent', ip: 'ipContent', profile: 'profileContent' };
  const arrowMap = { sub: 'subArrow', cap: 'capArrow', ip: 'ipArrow', profile: 'profileArrow' };
  const content = document.getElementById(map[type]);
  const arrow = document.getElementById(arrowMap[type]);
  content.classList.toggle('open');
  arrow.classList.toggle('open');
}

const render = (id, data, used) => {
  const ul = document.getElementById(id);
  ul.innerHTML = '';
  data.forEach((item, i) => {
    const li = document.createElement('li');
    li.className = used[item] ? 'checked' : '';
    li.innerHTML = `<input type="checkbox" ${used[item]?'checked':''}> <div class="text">${item}</div> <button class="delete">X</button>`;
    li.querySelector('input').onchange = () => { used[item] = !used[item]; save(); render(id,data,used); updateStats(); };
    li.querySelector('.delete').onclick = () => { if(confirm('Delete?')){ data.splice(i,1); delete used[item]; save(); render(id,data,used); updateStats(); }};
    ul.appendChild(li);
  });
};

const updateStats = () => {
  document.getElementById('subCount').textContent = subs.length;
  document.getElementById('subDone').textContent = Object.values(subChecked).filter(v=>v).length;
  document.getElementById('capCount').textContent = captions.length;
  document.getElementById('capUsed').textContent = Object.values(capUsed).filter(v=>v).length;
  updateIPHeader();
};

document.getElementById('subrBtn').onclick = () => {
  if(subs.length===0) return alert("Empty!");
  let attempts=0;
  while(attempts++ < subs.length){
    const sub = subs[subIndex];
    if(!subChecked[sub]){
      navigator.clipboard.writeText(sub);
      window.open(`https://www.reddit.com/r/${sub}/submit`, '_blank');
      subChecked[sub] = true; save(); render('subList',subs,subChecked); updateStats();
      subIndex = (subIndex + 1) % subs.length; save(); return;
    }
    subIndex = (subIndex + 1) % subs.length;
  }
  subChecked = {}; subIndex = 0; save(); render('subList',subs,subChecked); updateStats();
  alert("All done â†’ auto-reset!");
};

document.getElementById('captionBtn').onclick = () => {
  if(captions.length===0) return alert("Empty!");
  const unused = captions.filter(c => !capUsed[c]);
  if(unused.length===0){ capUsed={}; save(); render('captionList',captions,capUsed); updateStats(); alert("All used â†’ reset!"); }
  const pick = unused.length ? unused[Math.floor(Math.random()*unused.length)] : captions[Math.floor(Math.random()*captions.length)];
  navigator.clipboard.writeText(pick); capUsed[pick] = true; save(); render('captionList',captions,capUsed); updateStats(); triggerLua();
};

const randomNoRepeat = (arr, used) => {
  const unused = arr.filter(x => !used[x]);
  if(unused.length===0){ Object.keys(used).forEach(k=>delete used[k]); save(); showToast("Reset!"); return randomNoRepeat(arr, used); }
  const pick = unused[Math.floor(Math.random()*unused.length)];
  navigator.clipboard.writeText(pick); used[pick] = true; save(); triggerLua();
};

document.getElementById('fabD').onclick = () => randomNoRepeat(dmTexts, dmUsed);
document.getElementById('fabN').onclick = () => randomNoRepeat(names, nameUsed);
document.getElementById('fabOF').onclick = () => randomNoRepeat(ofLines, ofUsed);
document.getElementById('fabLink').onclick = () => { navigator.clipboard.writeText(linkUrl); showToast("Link copied"); triggerLua(); };

document.getElementById('subrReset').onclick = () => { if(confirm("Reset subs?")){ subChecked={}; subIndex=0; save(); render('subList',subs,subChecked); updateStats(); }};
document.getElementById('captionReset').onclick = () => { if(confirm("Reset captions?")){ capUsed={}; save(); render('captionList',captions,capUsed); updateStats(); }};
document.getElementById('toggleSub').onclick = () => { const l = document.getElementById('subList'); l.style.display = l.style.display==='block'?'none':'block'; };
document.getElementById('toggleCap').onclick = () => { const l = document.getElementById('captionList'); l.style.display = l.style.display==='block'?'none':'block'; };

document.getElementById('addSubBtn').onclick = (e) => { e.stopPropagation(); const input = prompt("Add one or more subreddits (one per line, no r/):"); if (!input) return; const lines = input.split('\n').map(l => l.trim()).filter(l => l); let added = 0; lines.forEach(sub => { if (sub && !subs.includes(sub)) { subs.push(sub); added++; } }); if (added > 0) { save(); render('subList', subs, subChecked); updateStats(); showToast(`Added ${added} subreddit${added > 1 ? 's' : ''}`); } else { showToast("Nothing new added"); } };
const subDeleteAllBtn = document.createElement('button'); subDeleteAllBtn.textContent = "Delete All"; subDeleteAllBtn.style.cssText = "background:gray;color:#000;padding:8px 14px;border-radius:12px;font-weight:bold;margin-left:8px;"; subDeleteAllBtn.onclick = () => { if (confirm("Delete ALL subreddits?")) { subs = []; subChecked = {}; subIndex = 0; save(); render('subList', subs, subChecked); updateStats(); showToast("All subreddits deleted"); } }; document.querySelector('#subContent .content-row:nth-of-type(1) > div').appendChild(subDeleteAllBtn);
document.getElementById('subRefresh').onclick = () => loadFromSheet();

document.getElementById('addCapBtn').onclick = (e) => { e.stopPropagation(); const input = prompt("Add one or more captions (one per line):"); if (!input) return; const lines = input.split('\n').map(l => l.trim()).filter(l => l); let added = 0; lines.forEach(cap => { if (cap && !captions.includes(cap)) { captions.push(cap); added++; } }); if (added > 0) { save(); render('captionList', captions, capUsed); updateStats(); showToast(`Added ${added} caption${added > 1 ? 's' : ''}`); } else { showToast("Nothing new added"); } };
const capDeleteAllBtn = document.createElement('button'); capDeleteAllBtn.textContent = "Delete All"; capDeleteAllBtn.style.cssText = "background:gray;color:#000;padding:8px 14px;border-radius:12px;font-weight:bold;margin-left:8px;"; capDeleteAllBtn.onclick = () => { if (confirm("Delete ALL captions?")) { captions = []; capUsed = {}; save(); render('captionList', captions, capUsed); updateStats(); showToast("All captions deleted"); } }; document.querySelector('#capContent .content-row:nth-of-type(1) > div').appendChild(capDeleteAllBtn);

function updateCaptionsNow() { localStorage.removeItem('caps3'); localStorage.removeItem('capUs3'); location.reload(); }

let userIP = '', previousIP = '', scamalyticsWindow = null;
function updateIPHeader() { const ip = document.getElementById('ip').textContent; document.getElementById('ipHeader').textContent = (ip && ip !== 'Loading...' && !ip.includes('Failed') && !ip.includes('Offline')) ? ip : 'No IP'; }
fetch('https://api.ipify.org?format=json').then(r => r.json()).then(d => { userIP = d.ip; document.getElementById("ip").textContent = userIP; updateIPHeader(); }).catch(() => { document.getElementById("ip").textContent = "Offline"; updateIPHeader(); });

function rotateIP() { const btn = document.getElementById("rotateBtn"); const url = document.getElementById("rotateLink").value.trim(); if (!url) return alert("Enter URL"); btn.disabled = true; btn.innerHTML = "Starting..."; new Image().src = url + (url.includes('?') ? '&' : '?') + 't=' + Date.now(); let s = 8; const timer = setInterval(() => { s--; btn.innerHTML = s > 0 ? `Wait ${s}s...` : "Done!"; if (s <= 0) clearInterval(timer); }, 1000); setTimeout(() => { btn.innerHTML = "Go"; btn.disabled = false; showToast("Rotation triggered!"); }, 8500); }

function refreshAndOpen() { const btn = document.getElementById("refreshBtn"); btn.disabled=true; btn.innerHTML="Loading..."; if (!scamalyticsWindow || scamalyticsWindow.closed) scamalyticsWindow = window.open('about:blank','_blank'); fetch('https://api.ipify.org?format=json').then(r=>r.json()).then(d=>{ if(userIP){ previousIP=userIP; document.getElementById("oldIP").textContent=previousIP; } userIP=d.ip; document.getElementById("ip").textContent=userIP; updateIPHeader(); scamalyticsWindow.location.href=`https://scamalytics.com/ip/${userIP}`; btn.style.backgroundColor = (previousIP && previousIP!==userIP) ? "#2e7d32" : "#d32f2f"; btn.innerHTML = (previousIP && previousIP!==userIP) ? "Changed!" : "No Change"; }).catch(()=>{ btn.style.backgroundColor="#b71c1c"; btn.innerHTML="Failed"; }).finally(()=>{ btn.disabled=false; }); }

function showToast(m) { const t = document.getElementById('toast'); t.textContent=m; t.classList.add('show'); clearTimeout(t.timeout); t.timeout=setTimeout(()=>t.classList.remove('show'),1800); }

document.getElementById('randomSubBtn').onclick = () => {
  if (randomSubList.length === 0) return showToast("No subs in column G");
  const random = randomSubList[Math.floor(Math.random() * randomSubList.length)];
  window.open("https://www.reddit.com/r/" + random, "_blank");
  showToast("Opened r/" + random);
};

let profileData = []; let currentRow = 2; let currentIndex = parseInt(localStorage.getItem('lastProfileIndex') || '0');
function loadProfiles() { fetch(PROFILE_URL + "?action=read&t=" + Date.now()).then(r => r.json()).then(d => { profileData = d.values || []; if (profileData.length === 0) { showToast("Sheet is empty"); clearProfileFields(); } else { if (currentIndex >= profileData.length) currentIndex = profileData.length - 1; loadProfile(currentIndex); showToast(`Profile ${currentIndex + 1}/${profileData.length} loaded`); } }).catch(() => showToast("Sheet offline")); }
function clearProfileFields() { document.getElementById('profileName').value = ''; document.getElementById('profilePass').value = ''; document.getElementById('profileUser').value = ''; document.getElementById('profileID').value = ''; }
function loadProfile(index) { if (profileData.length === 0) return; if (index < 0) index = 0; if (index >= profileData.length) index = profileData.length - 1; const row = profileData[index]; document.getElementById('profileName').value = row[0] || ''; document.getElementById('profilePass').value = row[1] || ''; document.getElementById('profileUser').value = row[2] || ''; document.getElementById('profileID').value = row[3] || ''; currentRow = index + 2; currentIndex = index; localStorage.setItem('lastProfileIndex', index); }
function prevProfile() { loadProfile(currentIndex - 1); }
function nextProfile() { loadProfile(currentIndex + 1); }
function generatePassword() { if (document.getElementById('profilePass').value !== '') { return showToast("Password not empty"); } const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*_-"; let randomPart = ""; const len = Math.floor(Math.random() * 5) + 10; for (let i = 0; i < len; i++) { randomPart += chars.charAt(Math.floor(Math.random() * chars.length)); } const finalPassword = "reddit" + randomPart; document.getElementById('profilePass').value = finalPassword; copyText('profilePass'); showToast(`Generated: ${finalPassword}`); }
async function pasteUsername() { try { const text = await navigator.clipboard.readText(); document.getElementById('profileUser').value = text.trim(); showToast("Username pasted"); } catch { showToast("Paste failed (allow clipboard)"); } }
function saveProfile() { const pass = document.getElementById('profilePass').value.trim(); const user = document.getElementById('profileUser').value.trim(); if (!pass || !user) return showToast("Fill Password & Username"); fetch(`${PROFILE_URL}?action=write&row=${currentRow}&pass=${encodeURIComponent(pass)}&user=${encodeURIComponent(user)}&t=${Date.now()}`).then(r => r.json()).then(() => { showToast("Saved to sheet"); profileData[currentIndex][1] = pass; profileData[currentIndex][2] = user; }).catch(() => showToast("Save failed")); }
function copyText(id) { const el = document.getElementById(id); el.focus(); el.select(); navigator.clipboard.writeText(el.value); showToast((el.placeholder || el.id) + " copied"); }
document.getElementById('fabCreate').onclick = () => { const currentID = document.getElementById('profileID').value.trim(); if (!currentID) { showToast("No ID loaded"); return; } navigator.clipboard.writeText(currentID); window.location.href = "shortcuts://run-shortcut?name=CreateRed"; showToast("ID copied â†’ CreateRed launched"); };

document.getElementById('comboFab').onclick = () => {
  if (subs.length === 0) return showToast("No subs left!");
  let sub = ''; let startIndex = subIndex;
  do { sub = subs[subIndex]; if (!subChecked[sub]) break; subIndex = (subIndex + 1) % subs.length; } while (subIndex !== startIndex);
  if (subChecked[sub]) { subChecked = {}; subIndex = 0; save(); showToast("All subs used â†’ Auto-reset!"); }
  subChecked[sub] = true; subIndex = (subIndex + 1) % subs.length; save();
  const unusedCaps = captions.filter(c => !capUsed[c]);
  if (unusedCaps.length === 0) { capUsed = {}; save(); showToast("Captions reset!"); return; }
  const caption = unusedCaps[Math.floor(Math.random() * unusedCaps.length)]; capUsed[caption] = true; save();
  const encodedTitle = encodeURIComponent(caption.trim());
  const redditUrl = `https://www.reddit.com/r/${sub}/submit?title=${encodedTitle}`;
  window.open(redditUrl, '_blank');
  render('subList', subs, subChecked); render('captionList', captions, capUsed); updateStats();
  navigator.clipboard.writeText(sub); showToast(`Posted â†’ r/${sub}`);
};

window.addEventListener('load', () => {
  updateToggleButton();
  ['subContent','capContent','ipContent','profileContent'].forEach(id => document.getElementById(id).classList.remove('open'));
  ['subArrow','capArrow','ipArrow','profileArrow'].forEach(id => document.getElementById(id).classList.remove('open'));
  updateIPHeader();
  loadFromSheet();
  loadProfiles();
});
</script>
</body>
</html>
